{% if 'pine' in underlay[inventory_hostname]['hostname'] %}
#
#Spine BGP
#
service routing protocols model multi-agent
!
ip prefix-list LOOPBACK
 permit 10.14.0.0 255.255.0.0 le 32
!
route-map LOOPBACK permit 10
  match ip address prefix-list LOOPBACK
!
peer-filter LEAF-AS-RANGE
  10 match as-range 65000-65535 result accept
!
router bgp {{ underlay[inventory_hostname]['BGP']['ASN'] }}
  router-id {{ underlay[inventory_hostname]['interfaces']['Loopback0']['ipv4']}}
  no bgp default ipv4-unicast
  maximum-paths 3
  distance bgp 20 200 200
  bgp listen range 10.14.0.0/16 peer-group LEAF_Underlay peer-filter LEAF-AS-RANGE
  neighbor LEAF_Underlay peer group
  neighbor LEAF_Underlay send-community
  neighbor LEAF_Underlay maximum-routes 12000
  redistribute connected route-map LOOPBACK
  !
  address-family ipv4
    neighbor LEAF_Underlay activate
    redistribute connected route-map LOOPBACK
!
{% elif 'eaf' in underlay[inventory_hostname]['hostname'] %}
#Leaf BGP
#
service routing protocols model multi-agent
!
ip prefix-list LOOPBACK
 permit 10.14.0.0 255.255.0.0 le 32
!
route-map LOOPBACK permit 10
  match ip address prefix-list LOOPBACK
!
router bgp {{ underlay[inventory_hostname]['BGP']['ASN'] }}
  router-id {{ underlay[inventory_hostname]['interfaces']['Loopback0']['ipv4']}}
  no bgp default ipv4-unicast
  maximum-paths 3
  distance bgp 20 200 200
  neighbor SPINE_Underlay peer group
  neighbor SPINE_Underlay remote-as 65000
  neighbor SPINE_Underlay send-community
  neighbor SPINE_Underlay maximum-routes 12000
  {% for peer in underlay[inventory_hostname]['BGP']['spine-peers'] %}
  neighbor {{ peer }} peer group SPINE_Underlay
  {% endfor %}
  neighbor LEAF_Peer peer group
  neighbor LEAF_Peer remote-as {{ underlay[inventory_hostname]['BGP']['ASN'] }}
  neighbor LEAF_Peer next-hop-self
  neighbor LEAF_Peer maximum-routes 12000
  neighbor {{ underlay[inventory_hostname]['BGP']['mlag-peer'] }} peer group LEAF_Peer
  redistribute connected route-map LOOPBACK
  !
  address-family ipv4
    neighbor SPINE_Underlay activate
    neighbor LEAF_Peer activate
    redistribute connected route-map LOOPBACK
 !
{% else %}
#No BGP configuration
{% endif %}